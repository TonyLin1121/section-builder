# 員工管理功能規格說明書

| 項目 | 內容 |
|------|------|
| 文件編號 | SRS-EMP-001 |
| 版本 | 1.0 |
| 建立日期 | 2026-01-20 |
| 作者 | System Analyst |
| 狀態 | 已核准 |

---

## 目錄

1. [文件簡介](#1-文件簡介)
2. [功能概述](#2-功能概述)
3. [使用者角色](#3-使用者角色)
4. [功能需求](#4-功能需求)
5. [資料規格](#5-資料規格)
6. [介面規格](#6-介面規格)
7. [API 規格](#7-api-規格)
8. [商業規則](#8-商業規則)
9. [錯誤處理](#9-錯誤處理)
10. [非功能需求](#10-非功能需求)

---

## 1. 文件簡介

### 1.1 目的

本文件詳細描述「員工管理」功能的完整需求規格，供開發人員依據本文件進行系統設計與實作。

### 1.2 範圍

本功能涵蓋員工資料的新增、查詢、修改、刪除（CRUD）操作，以及資料匯出功能。

### 1.3 名詞定義

| 名詞 | 說明 |
|------|------|
| 員工編號 (emp_id) | 員工唯一識別碼，為主鍵 |
| 員工類型 | 正職、經理人、工讀生、顧問、外包等身份分類 |
| 在職狀態 | 區分員工是否仍在職 |

---

## 2. 功能概述

### 2.1 功能目的

提供企業內部人員管理系統，維護員工基本資料，支援多維度查詢與資料匯出。

### 2.2 功能架構

```
員工管理
├── 員工清單
│   ├── 列表展示
│   ├── 搜尋篩選
│   ├── 分頁排序
│   └── 資料匯出
├── 新增員工
│   └── 表單輸入 → 資料驗證 → 儲存
├── 編輯員工
│   └── 載入資料 → 表單修改 → 資料驗證 → 更新
└── 刪除員工
    └── 確認刪除 → 執行刪除
```

### 2.3 使用情境

| 情境編號 | 情境描述 |
|----------|----------|
| UC-001 | 人資人員新增新進員工資料 |
| UC-002 | 人資人員修改員工職稱或部門 |
| UC-003 | 人資人員將離職員工標記為離職 |
| UC-004 | 主管查詢特定部門員工清單 |
| UC-005 | 人資人員匯出員工清單報表 |

---

## 3. 使用者角色

| 角色 | 權限說明 |
|------|----------|
| 一般使用者 | 可查詢員工清單、匯出資料 |
| 管理員 | 可執行所有 CRUD 操作 |

> **NOTE**: 目前系統未實作權限分離，所有登入使用者皆可執行完整功能。

---

## 4. 功能需求

### 4.1 員工清單查詢 (FR-001)

#### 4.1.1 功能描述

顯示員工資料列表，支援搜尋、篩選、分頁與排序功能。

#### 4.1.2 輸入條件

| 參數名稱 | 資料型態 | 必填 | 說明 |
|----------|----------|------|------|
| search | string | 否 | 關鍵字搜尋（姓名、編號、Email、職稱） |
| division | string | 否 | 部門篩選 |
| member_type | string[] | 否 | 員工類型篩選（可多選） |
| is_employed | boolean | 否 | 在職狀態篩選 |
| page | integer | 否 | 頁碼（預設 1） |
| page_size | integer | 否 | 每頁筆數（預設 20，最大 100） |
| sort_by | string | 否 | 排序欄位 |
| sort_order | string | 否 | 排序方向（asc/desc） |

#### 4.1.3 輸出結果

| 欄位名稱 | 資料型態 | 說明 |
|----------|----------|------|
| items | array | 員工資料陣列 |
| total | integer | 總筆數 |
| page | integer | 當前頁碼 |
| page_size | integer | 每頁筆數 |
| total_pages | integer | 總頁數 |

#### 4.1.4 處理邏輯

1. 根據篩選條件組合 WHERE 子句
2. 執行 COUNT 查詢取得總筆數
3. 根據排序條件加入 ORDER BY 子句
4. 計算 OFFSET 並加入 LIMIT 子句
5. 執行查詢並回傳結果

#### 4.1.5 可排序欄位

- emp_id（員工編號）
- chinese_name（中文姓名）
- name（英文姓名）
- division_name（部門）
- job_title（職稱）
- email（電子郵件）

---

### 4.2 新增員工 (FR-002)

#### 4.2.1 功能描述

新增一筆員工資料至資料庫。

#### 4.2.2 輸入欄位

| 欄位名稱 | 資料型態 | 必填 | 驗證規則 |
|----------|----------|------|----------|
| emp_id | string(12) | ✓ | 不可重複，不可為空 |
| chinese_name | string(20) | ✓ | 不可為空 |
| name | string(20) | - | 英文姓名 |
| division_name | string(20) | - | 從部門清單選擇 |
| job_title | string(255) | - | 自由輸入 |
| email | string(100) | - | 需符合 Email 格式 |
| cellphone | string(20) | - | 手機號碼 |
| office_phone | string(255) | - | 分機號碼 |
| birthday | string(10) | - | 日期格式 YYYY-MM-DD |
| is_member | boolean | - | 是否為正職（預設 true） |
| is_manager | boolean | - | 是否為經理人（預設 false） |
| is_intern | boolean | - | 是否為工讀生（預設 false） |
| is_consultant | boolean | - | 是否為顧問（預設 false） |
| is_outsourcing | boolean | - | 是否為外包（預設 false） |
| is_employed | boolean | - | 是否在職（預設 true） |
| line_id | string(50) | - | LINE ID |
| telegram_id | string(50) | - | Telegram ID |
| remark | string(255) | - | 備註 |

#### 4.2.3 處理邏輯

1. 前端驗證必填欄位
2. 前端驗證 Email 格式（若有填寫）
3. 呼叫後端 API
4. 後端檢查員工編號是否已存在
5. 若存在，回傳錯誤「員工編號已存在」
6. 若不存在，執行 INSERT 並回傳新增的資料

#### 4.2.4 成功條件

- 員工編號未重複
- 必填欄位皆已填寫
- Email 格式正確（若有填寫）

---

### 4.3 編輯員工 (FR-003)

#### 4.3.1 功能描述

修改既有員工資料。

#### 4.3.2 處理邏輯

1. 使用者點擊員工列表的「編輯」按鈕
2. 系統將員工資料填入表單
3. 員工編號欄位設為唯讀（主鍵不可修改）
4. 使用者修改欄位後送出
5. 後端檢查員工是否存在
6. 執行 UPDATE 並回傳更新後的資料

#### 4.3.3 前端行為

- 點擊編輯時，自動捲動至頁面頂部
- 表單標題變更為「編輯員工資料」
- 顯示「取消」按鈕

---

### 4.4 刪除員工 (FR-004)

#### 4.4.1 功能描述

刪除指定員工資料。

#### 4.4.2 處理邏輯

1. 使用者點擊「刪除」按鈕
2. 系統顯示確認對話框：「確定要刪除員工「{姓名}」嗎？」
3. 使用者確認後，呼叫刪除 API
4. 後端執行 DELETE 並回傳結果
5. 前端重新載入清單

#### 4.4.3 確認訊息顯示規則

優先使用中文姓名，若無則使用英文姓名，若皆無則使用員工編號。

---

### 4.5 資料匯出 (FR-005)

#### 4.5.1 功能描述

將員工清單匯出為 PDF、CSV 或 Excel 格式。

#### 4.5.2 匯出格式

| 格式 | 說明 |
|------|------|
| PDF | 支援預覽後下載 |
| CSV | 直接下載，UTF-8 編碼 |
| Excel | 直接下載，.xlsx 格式 |

#### 4.5.3 匯出欄位

| 欄位 | 標題 | 寬度 | 格式化 |
|------|------|------|--------|
| emp_id | 員工編號 | 25 | - |
| chinese_name | 中文姓名 | 30 | - |
| name | 英文姓名 | 30 | - |
| division_name | 部門 | 30 | - |
| job_title | 職稱 | 35 | - |
| email | Email | 50 | - |
| cellphone | 手機 | 30 | - |
| is_employed | 狀態 | 20 | true→在職 / false→離職 |
| member_type | 類型 | 25 | 組合顯示（如「正職/經理人」） |

---

## 5. 資料規格

### 5.1 資料表結構

**資料表名稱：** `member`

| 欄位名稱 | 資料型態 | 主鍵 | 允許 NULL | 預設值 | 說明 |
|----------|----------|------|-----------|--------|------|
| emp_id | VARCHAR(12) | ✓ | 否 | - | 員工編號 |
| chinese_name | VARCHAR(20) | - | 是 | NULL | 中文姓名 |
| name | VARCHAR(20) | - | 是 | NULL | 英文姓名 |
| division_no | VARCHAR(10) | - | 是 | NULL | 部門代號 |
| division_name | VARCHAR(20) | - | 是 | NULL | 部門名稱 |
| job_title | VARCHAR(255) | - | 是 | NULL | 職稱 |
| email | VARCHAR(100) | - | 是 | NULL | 電子郵件 |
| cellphone | VARCHAR(20) | - | 是 | NULL | 手機 |
| office_phone | VARCHAR(255) | - | 是 | NULL | 公司分機 |
| birthday | VARCHAR(10) | - | 是 | NULL | 生日 |
| is_member | BOOLEAN | - | 是 | FALSE | 正職員工 |
| is_manager | BOOLEAN | - | 是 | FALSE | 經理人 |
| is_intern | BOOLEAN | - | 是 | FALSE | 工讀生 |
| is_consultant | BOOLEAN | - | 是 | FALSE | 顧問 |
| is_outsourcing | BOOLEAN | - | 是 | FALSE | 外包 |
| is_employed | BOOLEAN | - | 是 | TRUE | 在職 |
| line_id | VARCHAR(50) | - | 是 | NULL | LINE ID |
| telegram_id | VARCHAR(50) | - | 是 | NULL | Telegram ID |
| remark | VARCHAR(255) | - | 是 | NULL | 備註 |

### 5.2 索引建議

| 索引名稱 | 欄位 | 類型 | 說明 |
|----------|------|------|------|
| pk_member | emp_id | PRIMARY | 主鍵 |
| idx_member_name | chinese_name | INDEX | 姓名查詢加速 |
| idx_member_division | division_name | INDEX | 部門篩選加速 |

---

## 6. 介面規格

### 6.1 頁面佈局

```
┌──────────────────────────────────────────────────────────────┐
│ Header                                                        │
│ ┌────────────────────────────────┐  ┌──────────┐ ┌─────────┐│
│ │ 👥 部門人員管理                │  │🔄 重新載入│ │📥 匯出 ▼││
│ │    Employee Management System  │  └──────────┘ └─────────┘│
│ └────────────────────────────────┘                          │
├──────────────────────────────────────────────────────────────┤
│ Form Section                                                  │
│ ┌──────────────────────────────────────────────────────────┐│
│ │ 新增員工 / 編輯員工資料                                  ││
│ │                                                          ││
│ │ [員工編號*] [中文姓名*] [英文姓名] [部門▼]              ││
│ │ [職稱    ] [Email   ] [手機    ] [分機  ]              ││
│ │ [生日    ] [LINE ID ] [Telegram]                        ││
│ │                                                          ││
│ │ 員工類型: ☑正職 ☐經理人 ☐工讀生 ☐顧問 ☐外包 ☑在職     ││
│ │                                                          ││
│ │ [備註                                                  ] ││
│ │                                                          ││
│ │                              [取消] [新增/更新]         ││
│ └──────────────────────────────────────────────────────────┘│
├──────────────────────────────────────────────────────────────┤
│ Search Section                                                │
│ ┌──────────────────────────────────────────────────────────┐│
│ │ 員工清單 (123)                                           ││
│ │                                                          ││
│ │ [🔍 搜尋...    ] [部門▼] [員工類型▼    ] [在職狀態▼]   ││
│ └──────────────────────────────────────────────────────────┘│
├──────────────────────────────────────────────────────────────┤
│ Table Section                                                 │
│ ┌──────────────────────────────────────────────────────────┐│
│ │ 員工編號↕ │ 姓名↕ │ 部門↕ │ 職稱 │ 身份 │ Email │ 狀態 │操作││
│ ├──────────┼──────┼──────┼─────┼─────┼──────┼─────┼────┤│
│ │ A001     │ 王小明│ 研發部│ 工程師│正職 │ a@b.c│ 在職 │✏️🗑️││
│ │ A002     │ 李小華│ 業務部│ 業務員│正職 │ d@e.f│ 在職 │✏️🗑️││
│ └──────────────────────────────────────────────────────────┘│
├──────────────────────────────────────────────────────────────┤
│ Pagination                                                    │
│ ┌──────────────────────────────────────────────────────────┐│
│ │ 每頁 [20▼] 筆  共 123 筆  [<] 1 2 3 ... 7 [>]           ││
│ └──────────────────────────────────────────────────────────┘│
├──────────────────────────────────────────────────────────────┤
│ Footer                                                        │
│ © 2026 部門人員管理系統                                       │
└──────────────────────────────────────────────────────────────┘
```

### 6.2 表格欄位規格

| 欄位 | 寬度 | 對齊 | 響應式 | 可排序 |
|------|------|------|--------|--------|
| 員工編號 | auto | 左 | 顯示 | ✓ |
| 姓名 | auto | 左 | 顯示 | ✓ |
| 部門 | auto | 左 | 顯示 | ✓ |
| 職稱 | auto | 左 | 平板隱藏 | ✓ |
| 身份 | auto | 左 | 手機隱藏 | - |
| Email | auto | 左 | 平板隱藏 | ✓ |
| 手機 | auto | 左 | 手機隱藏 | - |
| 狀態 | 60px | 中 | 顯示 | - |
| 操作 | 80px | 中 | 顯示 | - |

### 6.3 狀態標籤樣式

| 狀態 | 背景色 | 文字色 | 文字 |
|------|--------|--------|------|
| 在職 | #22c55e (綠) | #ffffff | 在職 |
| 離職 | #ef4444 (紅) | #ffffff | 離職 |

### 6.4 身份標籤樣式

| 身份 | 背景色 | 文字 |
|------|--------|------|
| 經理人 | 紫色 | 經理人 |
| 正職 | 藍色 | 正職 |
| 工讀生 | 綠色 | 工讀生 |
| 顧問 | 橙色 | 顧問 |
| 外包 | 灰色 | 外包 |

---

## 7. API 規格

### 7.1 取得員工清單

| 項目 | 規格 |
|------|------|
| 端點 | `GET /api/members` |
| 認證 | 需要 |
| CSRF | 不需要（GET 請求） |

**Request Parameters:**

```
search: string (optional)
division: string (optional)
member_type: string[] (optional)
is_employed: boolean (optional)
page: integer (optional, default=1)
page_size: integer (optional, default=20, max=100)
sort_by: string (optional)
sort_order: string (optional, default="asc")
```

**Response (200 OK):**

```json
{
  "items": [
    {
      "emp_id": "A001",
      "chinese_name": "王小明",
      "name": "Wang",
      "division_name": "研發部",
      "job_title": "工程師",
      "email": "wang@example.com",
      "cellphone": "0912345678",
      "is_member": true,
      "is_manager": false,
      "is_employed": true
    }
  ],
  "total": 100,
  "page": 1,
  "page_size": 20,
  "total_pages": 5
}
```

---

### 7.2 取得單一員工

| 項目 | 規格 |
|------|------|
| 端點 | `GET /api/members/{emp_id}` |
| 認證 | 需要 |

**Response (200 OK):**

```json
{
  "emp_id": "A001",
  "chinese_name": "王小明",
  "name": "Wang",
  ...
}
```

**Response (404 Not Found):**

```json
{
  "detail": "員工不存在"
}
```

---

### 7.3 新增員工

| 項目 | 規格 |
|------|------|
| 端點 | `POST /api/members` |
| 認證 | 需要 |
| CSRF | 需要 |
| Content-Type | application/json |

**Request Body:**

```json
{
  "emp_id": "A001",
  "chinese_name": "王小明",
  "name": "Wang",
  "division_name": "研發部",
  "job_title": "工程師",
  "email": "wang@example.com",
  "is_member": true,
  "is_employed": true
}
```

**Response (200 OK):** 回傳新增的員工資料

**Response (400 Bad Request):**

```json
{
  "detail": "員工編號已存在"
}
```

---

### 7.4 更新員工

| 項目 | 規格 |
|------|------|
| 端點 | `PUT /api/members/{emp_id}` |
| 認證 | 需要 |
| CSRF | 需要 |
| Content-Type | application/json |

**Request Body:** 僅包含要更新的欄位

**Response (200 OK):** 回傳更新後的員工資料

**Response (404 Not Found):**

```json
{
  "detail": "員工不存在"
}
```

---

### 7.5 刪除員工

| 項目 | 規格 |
|------|------|
| 端點 | `DELETE /api/members/{emp_id}` |
| 認證 | 需要 |
| CSRF | 需要 |

**Response (200 OK):**

```json
{
  "message": "刪除成功",
  "emp_id": "A001"
}
```

**Response (404 Not Found):**

```json
{
  "detail": "員工不存在"
}
```

---

### 7.6 取得部門清單

| 項目 | 規格 |
|------|------|
| 端點 | `GET /api/divisions` |
| 認證 | 需要 |

**Response (200 OK):**

```json
["研發部", "業務部", "財務部", "人資部"]
```

---

## 8. 商業規則

### 8.1 員工編號規則

| 規則編號 | 規則描述 |
|----------|----------|
| BR-001 | 員工編號為主鍵，不可重複 |
| BR-002 | 員工編號一旦建立，不可修改 |
| BR-003 | 員工編號最大長度 12 字元 |

### 8.2 員工類型規則

| 規則編號 | 規則描述 |
|----------|----------|
| BR-004 | 員工可同時具有多種類型（如同時為正職與經理人） |
| BR-005 | 篩選時，多選類型使用 OR 邏輯（顯示符合任一類型的員工） |

### 8.3 在職狀態規則

| 規則編號 | 規則描述 |
|----------|----------|
| BR-006 | 刪除員工前，建議先將狀態改為離職，保留歷史資料 |
| BR-007 | 離職員工仍可查詢，但預設篩選器不顯示 |

### 8.4 搜尋規則

| 規則編號 | 規則描述 |
|----------|----------|
| BR-008 | 搜尋關鍵字同時比對：中文姓名、英文姓名、員工編號、Email、職稱 |
| BR-009 | 搜尋使用模糊比對（ILIKE %keyword%） |
| BR-010 | 搜尋輸入使用 300ms debounce，避免過多 API 請求 |

---

## 9. 錯誤處理

### 9.1 前端錯誤處理

| 錯誤類型 | 處理方式 |
|----------|----------|
| 網路錯誤 | 顯示錯誤橫幅，提供「重試」按鈕 |
| API 錯誤 | 顯示後端回傳的錯誤訊息 |
| 驗證錯誤 | 在對應欄位下方顯示紅色錯誤訊息 |

### 9.2 後端錯誤代碼

| HTTP 狀態碼 | 錯誤情境 | 回應格式 |
|-------------|----------|----------|
| 400 | 請求參數錯誤 / 資料已存在 | `{"detail": "錯誤訊息"}` |
| 404 | 資源不存在 | `{"detail": "員工不存在"}` |
| 500 | 伺服器內部錯誤 | `{"detail": "錯誤詳情"}` |

### 9.3 錯誤訊息對照表

| 錯誤代碼 | 中文訊息 |
|----------|----------|
| EMP_NOT_FOUND | 員工不存在 |
| EMP_ID_EXISTS | 員工編號已存在 |
| EMPTY_UPDATE | 沒有要更新的欄位 |
| INVALID_EMAIL | 電子郵件格式不正確 |
| REQUIRED_FIELD | 請輸入{欄位名稱} |

---

## 10. 非功能需求

### 10.1 效能需求

| 項目 | 規格 |
|------|------|
| 清單載入時間 | < 2 秒（100 筆以內） |
| 單筆操作時間 | < 1 秒 |
| 每頁最大筆數 | 100 筆 |

### 10.2 安全需求

| 項目 | 規格 |
|------|------|
| 認證 | 所有 API 需登入後才能存取 |
| CSRF | 所有寫入操作（POST/PUT/DELETE）需附帶 CSRF Token |
| 輸入驗證 | 後端使用 Pydantic 進行參數驗證 |

### 10.3 相容性需求

| 項目 | 規格 |
|------|------|
| 瀏覽器 | Chrome 90+, Firefox 88+, Safari 14+, Edge 90+ |
| 螢幕寬度 | 支援 320px 以上（RWD） |

### 10.4 可用性需求

| 項目 | 規格 |
|------|------|
| 載入中提示 | 顯示載入動畫 |
| 空資料提示 | 顯示「尚無員工資料」訊息 |
| 操作確認 | 刪除前顯示確認對話框 |
| 編輯模式提示 | 編輯時自動捲動至表單區域 |

---

## 附錄 A：相關文件

| 文件名稱 | 說明 |
|----------|------|
| [FEATURE_TEMPLATE.md](./FEATURE_TEMPLATE.md) | 功能開發範本 |
| [DEPLOYMENT.md](./DEPLOYMENT.md) | 部署指南 |

---

## 附錄 B：變更歷史

| 版本 | 日期 | 作者 | 變更說明 |
|------|------|------|----------|
| 1.0 | 2026-01-20 | SA | 初版建立 |
