# 系統管理功能規格說明書

| 項目 | 內容 |
|------|------|
| 文件編號 | SRS-SYS-001 |
| 版本 | 1.0 |
| 建立日期 | 2026-01-20 |
| 作者 | System Analyst |
| 狀態 | 已核准 |

---

## 1. 文件簡介

### 1.1 目的

本文件詳細描述「系統管理」功能的完整需求規格，供開發人員依據本文件進行系統設計與實作。

### 1.2 範圍

本功能涵蓋系統使用者管理、角色管理、選單管理及密碼政策設定。

### 1.3 存取權限

> **IMPORTANT**: 系統管理功能僅限 ADMIN 角色使用者存取。

---

## 2. 功能概述

### 2.1 功能架構

```
系統管理
├── 使用者管理
│   ├── 使用者清單
│   ├── 新增使用者
│   ├── 編輯使用者
│   ├── 刪除使用者
│   └── 重設密碼
├── 角色管理
│   ├── 角色清單
│   ├── 新增角色
│   ├── 編輯角色
│   └── 刪除角色
├── 選單管理
│   ├── 選單清單
│   ├── 新增選單
│   ├── 編輯選單
│   └── 刪除選單
└── 密碼政策
    └── 政策設定
```

---

## 3. 使用者管理

### 3.1 功能描述

管理系統使用者帳號，包含帳號基本資料、角色指派及密碼管理。

### 3.2 資料規格

**資料表名稱：** `sys_users`

| 欄位名稱 | 資料型態 | 主鍵 | 說明 |
|----------|----------|------|------|
| id | SERIAL | ✓ | 使用者 ID（自動產生） |
| username | VARCHAR(50) | - | 使用者帳號（唯一） |
| password_hash | VARCHAR(255) | - | 密碼雜湊 |
| display_name | VARCHAR(100) | - | 顯示名稱 |
| email | VARCHAR(100) | - | 電子郵件 |
| role | VARCHAR(20) | - | 角色（USER/ADMIN） |
| is_active | BOOLEAN | - | 是否啟用 |
| created_at | TIMESTAMP | - | 建立時間 |
| updated_at | TIMESTAMP | - | 更新時間 |
| last_login | TIMESTAMP | - | 最後登入時間 |

### 3.3 功能需求

#### 3.3.1 使用者清單 (FR-001)

**輸入條件：**

| 參數 | 說明 |
|------|------|
| search | 搜尋帳號或顯示名稱 |
| role | 角色篩選 |
| is_active | 狀態篩選 |

#### 3.3.2 新增使用者 (FR-002)

**輸入欄位：**

| 欄位 | 必填 | 說明 |
|------|------|------|
| username | ✓ | 使用者帳號 |
| password | ✓ | 初始密碼 |
| display_name | - | 顯示名稱 |
| email | - | 電子郵件 |
| role | ✓ | 角色 |
| is_active | - | 是否啟用（預設 true） |

#### 3.3.3 重設密碼 (FR-003)

管理員可重設使用者密碼為指定的新密碼。

---

## 4. 角色管理

### 4.1 功能描述

管理系統角色，定義角色基本資訊。

### 4.2 資料規格

**資料表名稱：** `sys_roles`

| 欄位名稱 | 資料型態 | 主鍵 | 說明 |
|----------|----------|------|------|
| id | SERIAL | ✓ | 角色 ID |
| role_code | VARCHAR(20) | - | 角色代碼（唯一） |
| role_name | VARCHAR(50) | - | 角色名稱 |
| description | VARCHAR(255) | - | 角色描述 |
| is_active | BOOLEAN | - | 是否啟用 |
| created_at | TIMESTAMP | - | 建立時間 |

### 4.3 預設角色

| 角色代碼 | 角色名稱 | 說明 |
|----------|----------|------|
| ADMIN | 管理員 | 可存取所有功能 |
| USER | 一般使用者 | 僅限基本功能 |

---

## 5. 選單管理

### 5.1 功能描述

管理系統側邊選單項目，支援階層式選單結構。

### 5.2 資料規格

**資料表名稱：** `sys_menus`

| 欄位名稱 | 資料型態 | 主鍵 | 說明 |
|----------|----------|------|------|
| id | SERIAL | ✓ | 選單 ID |
| menu_code | VARCHAR(20) | - | 選單代碼 |
| menu_name | VARCHAR(50) | - | 選單名稱 |
| parent_id | INTEGER | - | 父選單 ID（NULL 表示頂層） |
| path | VARCHAR(100) | - | 路由路徑 |
| icon | VARCHAR(50) | - | 圖示 |
| sort_order | INTEGER | - | 排序順序 |
| is_active | BOOLEAN | - | 是否啟用 |

### 5.3 功能需求

#### 5.3.1 選單清單 (FR-001)

以樹狀結構顯示選單項目，支援拖拉排序。

#### 5.3.2 新增選單 (FR-002)

**輸入欄位：**

| 欄位 | 必填 | 說明 |
|------|------|------|
| menu_code | ✓ | 選單代碼 |
| menu_name | ✓ | 選單名稱 |
| parent_id | - | 父選單（空為頂層） |
| path | ✓ | 路由路徑 |
| icon | - | 圖示 |
| sort_order | - | 排序順序 |

---

## 6. 密碼政策

### 6.1 功能描述

設定系統密碼強度與過期政策。

### 6.2 資料規格

**資料表名稱：** `sys_password_policy`

| 欄位名稱 | 資料型態 | 說明 |
|----------|----------|------|
| id | SERIAL | 政策 ID |
| min_length | INTEGER | 最小長度 |
| require_uppercase | BOOLEAN | 需要大寫字母 |
| require_lowercase | BOOLEAN | 需要小寫字母 |
| require_number | BOOLEAN | 需要數字 |
| require_special | BOOLEAN | 需要特殊字元 |
| expire_days | INTEGER | 密碼過期天數（0 表示不過期） |
| history_count | INTEGER | 不可重複使用最近幾次密碼 |

### 6.3 功能需求

#### 6.3.1 取得密碼政策 (FR-001)

取得當前系統密碼政策設定。

#### 6.3.2 更新密碼政策 (FR-002)

**輸入欄位：**

| 欄位 | 預設值 | 說明 |
|------|--------|------|
| min_length | 8 | 最小長度（4-32） |
| require_uppercase | true | 需要大寫字母 |
| require_lowercase | true | 需要小寫字母 |
| require_number | true | 需要數字 |
| require_special | false | 需要特殊字元 |
| expire_days | 90 | 過期天數（0 表示不過期） |
| history_count | 3 | 密碼歷史記錄數 |

---

## 7. 介面規格

### 7.1 頁面佈局

使用 Tab 切換不同功能區塊：

```
┌──────────────────────────────────────────────────────────────┐
│ Header: ⚙️ 系統管理                                          │
├──────────────────────────────────────────────────────────────┤
│ Tabs: [使用者管理] [角色管理] [選單管理] [密碼政策]          │
├──────────────────────────────────────────────────────────────┤
│ Content Area (依選擇的 Tab 顯示對應內容)                     │
│                                                              │
│ ┌──────────────────────────────────────────────────────────┐│
│ │ Form: 新增/編輯                                          ││
│ ├──────────────────────────────────────────────────────────┤│
│ │ Table: 資料清單                                          ││
│ └──────────────────────────────────────────────────────────┘│
└──────────────────────────────────────────────────────────────┘
```

### 7.2 路由設計

| 路徑 | 說明 |
|------|------|
| /system | 系統管理首頁 |
| /system/users | 使用者管理 |
| /system/roles | 角色管理 |
| /system/menus | 選單管理 |
| /system/password-policy | 密碼政策 |

---

## 8. API 規格

### 8.1 使用者管理 API

| 端點 | 方法 | 說明 |
|------|------|------|
| `/api/system/users` | GET | 取得使用者清單 |
| `/api/system/users` | POST | 新增使用者 |
| `/api/system/users/{id}` | PUT | 更新使用者 |
| `/api/system/users/{id}` | DELETE | 刪除使用者 |
| `/api/system/users/{id}/reset-password` | POST | 重設密碼 |

### 8.2 角色管理 API

| 端點 | 方法 | 說明 |
|------|------|------|
| `/api/system/roles` | GET | 取得角色清單 |
| `/api/system/roles` | POST | 新增角色 |
| `/api/system/roles/{id}` | PUT | 更新角色 |
| `/api/system/roles/{id}` | DELETE | 刪除角色 |

### 8.3 選單管理 API

| 端點 | 方法 | 說明 |
|------|------|------|
| `/api/system/menus` | GET | 取得選單清單 |
| `/api/system/menus` | POST | 新增選單 |
| `/api/system/menus/{id}` | PUT | 更新選單 |
| `/api/system/menus/{id}` | DELETE | 刪除選單 |

### 8.4 密碼政策 API

| 端點 | 方法 | 說明 |
|------|------|------|
| `/api/system/password-policy` | GET | 取得密碼政策 |
| `/api/system/password-policy` | PUT | 更新密碼政策 |

---

## 9. 商業規則

### 9.1 使用者管理

| 規則編號 | 規則描述 |
|----------|----------|
| BR-001 | 使用者帳號不可重複 |
| BR-002 | 不可刪除最後一個 ADMIN 使用者 |
| BR-003 | 不可刪除自己的帳號 |
| BR-004 | 密碼需符合密碼政策要求 |

### 9.2 角色管理

| 規則編號 | 規則描述 |
|----------|----------|
| BR-005 | 角色代碼不可重複 |
| BR-006 | 已被使用者參照的角色不可刪除 |

### 9.3 選單管理

| 規則編號 | 規則描述 |
|----------|----------|
| BR-007 | 選單代碼不可重複 |
| BR-008 | 有子選單的項目不可刪除 |

---

## 10. 錯誤處理

| 錯誤代碼 | 中文訊息 |
|----------|----------|
| USER_NOT_FOUND | 使用者不存在 |
| USERNAME_EXISTS | 使用者帳號已存在 |
| CANNOT_DELETE_SELF | 不可刪除自己的帳號 |
| CANNOT_DELETE_LAST_ADMIN | 不可刪除最後一個管理員 |
| ROLE_NOT_FOUND | 角色不存在 |
| ROLE_IN_USE | 角色使用中，無法刪除 |
| MENU_NOT_FOUND | 選單不存在 |
| MENU_HAS_CHILDREN | 選單有子項目，無法刪除 |
| PASSWORD_TOO_WEAK | 密碼強度不足 |

---

## 附錄：變更歷史

| 版本 | 日期 | 作者 | 變更說明 |
|------|------|------|----------|
| 1.0 | 2026-01-20 | SA | 初版建立 |
